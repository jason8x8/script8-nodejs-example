<?xml version="1.0" encoding="UTF-8" ?>
<cpxml xmlns="http://www.8x8.com/cpxml" name="example" version="1.0">
    <meta name="author" value="Jason Liu" />
    <meta name="copyright" value="8x8 Inc" />
    <meta name="email" value="jliu@8x8.com" />
    <meta name="logLevel" value="debug" />

    <script>
        <![CDATA[
            function uuidv4() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            function createConferenceId() {
/*                var confId = uuid4(); */
                return 'voice-proxy';
            }
            function createPushMessage(conferenceId) {
                return {"conferenceId" : conferenceId };
            }
        ]]>
    </script>
	<!--
    <log expr="'I got conference call'"/>
-->
    <var name="confId" expr="createConferenceId()"/>
	<!--
    <http name="pnsResult" url="http://httpbin.org/post" httpMethod="POST" contentType="application/json">
        <param name="dt" body="false" expr="new Date().toDateString()"/>
        <header name="Authorization" expr="'Basic amFzb25fb2F1dGg6d2VsY29tZTEyMw=='"/>
        <body expr="JSON.stringify(createPushMessage(confId))"/>
    </http>
    <log expr="'I got resp:'+JSON.stringify(pnsResult)"/>
    <say expr="'Ok, we will put you into to a conference now, please wait ...'"/>
	-->
    
    <say expr="'Ok, we will put you into to a conference now, please wait ...'"/>
    <joinConference expr="confId" confMode="voiceProxy">
        <onSoloParticipant>
            <Say>Hello you are the only one in the conference now, please enjoy the music while waiting...</Say>
            <play maxTime="10" timeUnit="seconds" url="/music/bach.au"/>
            <!-- 
            <play maxTime="10" timeUnit="seconds">
                <audio src="bach"/>
            </play> 
            -->
        </onSoloParticipant>
        <onEnterConference notification='/EnterConference'/>
        <onLeaveConference action='/LeaveConference'/>
    </joinConference>
</cpxml>
